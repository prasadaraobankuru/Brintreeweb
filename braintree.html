<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Braintree PayPal Checkout</title>

    <script src="https://js.braintreegateway.com/web/3.129.0/js/client.min.js"></script>
    <script src="https://js.braintreegateway.com/web/3.129.0/js/paypal-checkout.min.js"></script>
    <script src="https://www.paypalobjects.com/api/checkout.js"></script>
  </head>
  <body>
    <h3>Processing PayPal Checkout...</h3>

    <script>
      const clientToken = "sandbox_38zsjnr9_ydwkdrfr4jvvhf98";
      const amount = "10.00";
      const currency = "USD";

      braintree.client.create({ authorization: clientToken }, function (err, clientInstance) {
        if (err) {
          alert("Client init failed");
          return;
        }

        braintree.paypalCheckout.create({ client: clientInstance }, function (err, paypalCheckoutInstance) {
          if (err) {
            alert("PayPal init failed");
            return;
          }

          paypalCheckoutInstance.loadPayPalSDK({ currency: currency }, function () {
            paypal.Button.render(
              {
                env: "sandbox",
                payment: function () {
                  return paypalCheckoutInstance.createPayment({
                    flow: "checkout",
                    amount: amount,
                    currency: currency
                  });
                },
                onAuthorize: function (data) {
                  paypalCheckoutInstance.tokenizePayment(data, function (err, payload) {
                    if (err) {
                      alert("Tokenization failed: " + err);
                      return;
                    }

                    alert("Payment complete! Nonce: " + payload.nonce);

                    // âœ… Send nonce back to Android via custom URL scheme
                    window.location.href =
                      "com.example.aldimobile://paypal?nonce=" + encodeURIComponent(payload.nonce);
                  });
                },
                onCancel: function () {
                  alert("Payment cancelled");
                  window.location.href = "com.example.aldimobile://paypal?cancelled=true";
                },
                onError: function (err) {
                  alert("Error: " + err);
                  window.location.href = "com.example.aldimobile://paypal?error=" + encodeURIComponent(err);
                }
              },
              document.body
            );
          });
        });
      });
    </script>
  </body>
</html>

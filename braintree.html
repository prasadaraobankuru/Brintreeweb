<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PopupBridge PayPal Checkout</title>
  <script src="https://js.braintreegateway.com/web/3.96.0/js/client.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.96.0/js/paypal-checkout.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.96.0/js/popup-bridge.min.js"></script>
</head>
<body>
  <h3>Redirecting to PayPal...</h3>

  <script>
    const CLIENT_TOKEN = "sandbox_38zsjnr9_ydwkdrfr4jvvhf98"; // replace with your own sandbox token

    braintree.client.create({
      authorization: CLIENT_TOKEN
    }, function (clientErr, clientInstance) {
      if (clientErr) {
        alert("Braintree init failed");
        return;
      }

      braintree.paypalCheckout.create({
        client: clientInstance
      }, function (paypalCheckoutErr, paypalCheckoutInstance) {
        if (paypalCheckoutErr) {
          alert("PayPal init failed");
          return;
        }

        // Automatically start the PayPal checkout
        paypalCheckoutInstance.createPayment({
          flow: 'checkout',
          amount: '10.00',
          currency: 'USD'
        }).then(function (paymentId) {
          if (window.popupBridge) {
            window.popupBridge.open(paymentId);
          } else {
            alert("PopupBridge not available");
          }
        });

        // Callback from PopupBridge when user finishes
        window.popupBridge.onComplete = function (err, payload) {
          if (err) {
            alert("Error: " + err.message);
            return;
          }
          if (payload && payload.nonce) {
            window.location.href = "com.example.aldimobile://paypal?nonce=" + payload.nonce;
          }
        };
      });
    });
  </script>
</body>
</html>
